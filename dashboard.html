<!doctype html><html lang="pt"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Dashboard</title><link rel="stylesheet" href="style.css"></head><body onload="checkAuth()"><div class="container"><div class="header"><div class="brand"><img src="logo.png" alt="logo"><div><h1>Dashboard</h1><div class="small">Visão geral</div></div></div><div><a class="btn btn-ghost" href="gestao.html">Gestão</a> <a class="btn" href="vendas.html">Loja</a></div></div><main><div class="grid"><div class="card"><h3>Vendas (últimos pedidos)</h3><canvas id="salesChart"></canvas></div><div class="card"><h3>Stock por Categoria</h3><canvas id="stockChart"></canvas></div><div class="card"><h3>Mensagens</h3><div id="msgPreview" class="small"></div></div></div></main><div class="footer small">Protótipo</div></div><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="auth.js"></script><script src="db.js"></script><script>function checkAuth(){ if(!Auth.current()) location.href='login.html'; } function getSales(){ const ord=listOrders(); const months={}; ord.forEach(o=>{ const d=new Date(o.date); const k=(d.getMonth()+1)+'/'+d.getFullYear(); months[k]=(months[k]||0)+o.total; }); const labels=Object.keys(months).slice(0,6); const data=labels.map(l=>months[l]); return {labels,data}; } function getStockByCat(){ const arr=DB.all(); const map={}; arr.forEach(p=>{ const c=p.category||'Sem Categoria'; map[c]=(map[c]||0)+Number(p.quantity||0); }); return {labels:Object.keys(map),data:Object.values(map)}; } const s=getSales(); const ctx=document.getElementById('salesChart').getContext('2d'); new Chart(ctx,{type:'bar',data:{labels:s.labels,datasets:[{label:'Vendas (Kz)',data:s.data, backgroundColor:'#4f46e5'}]}}); const st=getStockByCat(); new Chart(document.getElementById('stockChart').getContext('2d'),{type:'pie',data:{labels:st.labels,datasets:[{data:st.data}]}}); document.getElementById('msgPreview').innerHTML = listMessages().slice(-5).map(m=>'<div>'+m.from+': '+m.text+'</div>').join('');</script></body></html>