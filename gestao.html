<!doctype html><html lang="pt"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Gestão - Admin</title><link rel="stylesheet" href="style.css"></head><body onload="checkAuth()"><div class="container"><div class="header"><div class="brand"><img src="logo.png" alt="logo"><div><h1>Admin</h1><div class="small">Painel de Gestão</div></div></div><div><button class="btn btn-ghost" onclick="location.href='dashboard.html'">Dashboard</button> <button class="btn btn-ghost" onclick="location.href='seo.html'">SEO</button> <button class="btn" onclick="logout()">Sair</button></div></div><main><div class="card"><h3>Produtos</h3><div style="margin-top:12px"><button class="btn" id="btnAdd">Adicionar Produto</button> <button class="btn btn-ghost" id="btnExport">Exportar</button> <button class="btn btn-ghost" id="btnImport">Importar</button> <input type="file" id="fileImport" style="display:none" accept="application/json"></div><div style="margin-top:12px"><table class="table"><thead><tr><th>Imagem</th><th>Nome</th><th>Código</th><th>Qtd</th><th>Preço</th><th>Ações</th></tr></thead><tbody id="prodTable"></tbody></table></div></div><div class="card"><h3>Pedidos Recentes</h3><div id="ordersList" class="small"></div></div></main><div class="footer small">Protótipo</div></div><div class="modal-backdrop" id="modal"><div class="modal card"><h3 id="modalTitle">Adicionar Produto</h3><form id="prodForm"><div class="form-row"><input id="pname" class="input" placeholder="Nome"><input id="pcode" class="input" placeholder="Código"></div><div class="form-row"><input id="pcat" class="input" placeholder="Categoria"><input id="pprice" class="input" placeholder="Preço" type="number"></div><div class="form-row"><input id="pqty" class="input" placeholder="Quantidade" type="number"><input id="preorder" class="input" placeholder="Stock mínimo" type="number"></div><div style="margin-top:8px"><input id="pimg" type="file" accept="image/*"></div><div id="imgPreview" style="margin-top:8px"></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button type="button" class="btn btn-ghost" id="btnCancel">Cancelar</button><button class="btn" type="submit">Salvar</button></div></form></div></div><script src="auth.js"></script><script src="db.js"></script><script src="app.js"></script><script>function checkAuth(){ if(!Auth.current()) location.href='login.html'; } function logout(){ Auth.logout(); location.href='login.html'; } const prodTable=document.getElementById('prodTable'); const btnAdd=document.getElementById('btnAdd'); const modal=document.getElementById('modal'); const prodForm=document.getElementById('prodForm'); const fileImport=document.getElementById('fileImport'); let editing=null; let imageData=null; function render(){ const arr=DB.all(); prodTable.innerHTML=arr.map(p=>`<tr><td style="width:90px"><img src="${p.image||'https://via.placeholder.com/160x100?text=Sem+imagem'}" style="width:80px;height:50px;object-fit:cover;border-radius:6px"></td><td>${p.name}</td><td>${p.code}</td><td>${p.quantity}</td><td>${formatKz(p.price)}</td><td><button class="btn btn-ghost" onclick="editProd('${p.id}')">Editar</button> <button class="btn btn-ghost" onclick="delProd('${p.id}')">Excluir</button></td></tr>`).join(''); renderOrders(); } function openModal(id){ editing=null; imageData=null; prodForm.reset(); document.getElementById('imgPreview').innerHTML=''; modal.style.display='flex'; if(id){ const p=DB.find(id); if(p){ editing=id; document.getElementById('pname').value=p.name; document.getElementById('pcode').value=p.code; document.getElementById('pcat').value=p.category; document.getElementById('pprice').value=p.price; document.getElementById('pqty').value=p.quantity; document.getElementById('preorder').value=p.reorder||0; if(p.image){ imageData=p.image; document.getElementById('imgPreview').innerHTML='<img src="'+p.image+'" style="max-width:160px;border-radius:8px">'; } } } } function closeModal(){ modal.style.display='none'; editing=null; imageData=null; } document.getElementById('pimg').addEventListener('change', async function(e){ const f=e.target.files[0]; if(!f) return; imageData = await compressImage(f,800,0.75); document.getElementById('imgPreview').innerHTML = '<img src="'+imageData+'" style="max-width:160px;border-radius:8px">'; }); btnAdd.addEventListener('click',()=>openModal()); document.getElementById('btnCancel').addEventListener('click',()=>closeModal()); prodForm.addEventListener('submit',function(e){ e.preventDefault(); const payload={ name:document.getElementById('pname').value.trim(), code:document.getElementById('pcode').value.trim(), category:document.getElementById('pcat').value.trim(), price:Number(document.getElementById('pprice').value)||0, quantity:Number(document.getElementById('pqty').value)||0, reorder:document.getElementById('preorder').value?Number(document.getElementById('preorder').value):null, image:imageData }; if(editing){ DB.update(editing,payload); } else { DB.add(payload); } render(); closeModal(); }); function editProd(id){ openModal(id); } function delProd(id){ if(confirm('Eliminar?')){ DB.remove(id); render(); } } document.getElementById('btnExport').addEventListener('click',function(){ const data=JSON.stringify(DB.all(),null,2); const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([data],{type:'application/json'})); a.download='produtos.json'; a.click(); }); document.getElementById('btnImport').addEventListener('click',()=>fileImport.click()); fileImport.addEventListener('change',function(e){ const f=e.target.files[0]; if(!f) return; const reader=new FileReader(); reader.onload=ev=>{ if(DB.import(ev.target.result)){ alert('Import ok'); render(); } else alert('Arquivo inválido'); }; reader.readAsText(f); }); // orders render and export function renderOrders(){ const ord=listOrders(); const el=document.getElementById('ordersList'); if(ord.length===0){ el.innerHTML='<div class="small">Sem pedidos.</div>'; return;} el.innerHTML=ord.map(o=>`<div style="border-bottom:1px solid rgba(255,255,255,0.03);padding:8px"><strong>${o.customer.name}</strong> - ${new Date(o.date).toLocaleString()}<div class="small">${o.items.map(i=>i.name+' x'+i.qty).join(', ')}</div><div class="small">Contacto: ${o.customer.phone} - ${o.customer.email}</div></div>`).join(''); } render();</script></body></html>